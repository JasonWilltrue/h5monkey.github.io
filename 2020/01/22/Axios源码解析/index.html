<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="好前端才分对错，成年人只分利弊">
    <meta name="author" content="Mariogogogo">
    
    <title>
        
            Axios 源码解析 |
        
        Mario Blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/logo.svg">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/css/font-awesome.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"mariogogogo.github.io","root":"/","language":"zh-CN","path":"search.xml"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":true,"init_open":true},"style":{"primary_color":"#0066CC","avatar":"/images/avatar.svg","favicon":"/images/logo.svg","article_img_align":"left","left_side_width":"260px","content_max_width":"1240px","hover":{"shadow":true,"scale":true},"first_screen":{"enable":false,"background_img":"/images/bg.svg","description":"Keep writing and Keep loving."},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":true}}},"local_search":{"enable":true,"preload":true},"code_copy":{"enable":true,"style":"default"},"pjax":{"enable":false},"lazyload":{"enable":true},"version":"3.4.3"};
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 月前","year":"%s 年前"};
  </script>
<meta name="generator" content="Hexo 5.3.0"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                Mario Blog
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                归档
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                分类
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                标签
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/links"
                            >
                                友链
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">归档</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">分类</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">标签</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/links">友链</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">Axios 源码解析</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.svg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">Mariogogogo</span>
                        
                            <span class="author-label">Lv6</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;2020-01-22 00:00:00
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/JavaScript/">JavaScript</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/JavaScript/">JavaScript</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>2.7k 字</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fas fa-clock"></i>&nbsp;<span>12 分钟</span>
        </span>
    
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h2 id="首先对-axios-提出几个问题"><a href="#首先对-axios-提出几个问题" class="headerlink" title="首先对 axios 提出几个问题"></a>首先对 axios 提出几个问题</h2><ol>
<li>为什么 <code>axios</code> 既可以当函数调用，也可以当对象使用，比如<code>axios(&#123;url,method&#125;)</code>、<code>axios.get</code>。</li>
<li>简述 axios 调用流程。</li>
<li>有用过拦截器吗？原理是怎样的？</li>
<li>有使用 axios 的取消功能吗？是怎么实现的？</li>
<li>为什么支持浏览器中发送请求也支持 node 发送请求？</li>
</ol>
<p>带着问题我们进入源码去看看吧</p>
<a id="more"></a>
<h2 id="axios-简介"><a href="#axios-简介" class="headerlink" title="axios 简介"></a>axios 简介</h2><p><code>axios</code> 是目前最常用的 <code>HTTP</code> 请求库，即可以用于前端浏览器也可以在后端 <code>node.js</code> 中使用，在 <code>github</code> 上的 <code>star</code> 数已经有 <code>6w+</code> 了，它也是 <code>vue.js</code> 官方极力推荐的，前端（全栈）开发必不可少的库，它的主要特性包括</p>
<ul>
<li>基于 <code>Promise</code></li>
<li>支持 前端浏览器环境 和 后端 <code>node.js</code> 环境</li>
<li>可添加拦截器转换请求和响应数据</li>
<li>支持请求取消</li>
<li>自动转换 <code>JSON</code> 数据</li>
<li>客户端支持防范 <code>XSRF</code></li>
<li>支持各主流浏览器以及 <code>IE8+</code></li>
</ul>
<h2 id="axios-返回信息"><a href="#axios-返回信息" class="headerlink" title="axios 返回信息"></a>axios 返回信息</h2><p><img src="http://book.52react.cn/20200121123122.png" alt=""></p>
<h2 id="知识要点"><a href="#知识要点" class="headerlink" title="知识要点"></a>知识要点</h2><ul>
<li>XMLHttpRequest</li>
<li>Promise 异步编程</li>
<li>工具函数库：bind、extend、deepCopy、deepMerge……</li>
<li>拦截器：Interceptor</li>
<li>拦截器管理：InterceptorManager</li>
<li>适配器：Adaptor</li>
<li>工厂函数：createInstance</li>
</ul>
<h2 id="为什么-axios-支持对象又支持函数"><a href="#为什么-axios-支持对象又支持函数" class="headerlink" title="为什么 axios 支持对象又支持函数"></a>为什么 axios 支持对象又支持函数</h2><blockquote>
<p>axios 本质是函数，赋值了一些别名方法，比如 get、post 方法，可被调用，最终调用的还是 Axios.prototype.request 函数。</p>
</blockquote>
<h3 id="axios-与-Axios-的关系"><a href="#axios-与-Axios-的关系" class="headerlink" title="axios 与 Axios 的关系"></a>axios 与 Axios 的关系</h3><ol>
<li>从功能说 axios 是 Axios 的实例 (拥有功能,有属性)</li>
<li>从语法说 axios 不是 Axios 的实例 (是个函数)</li>
<li>axios 是 Axios.prototype.request 函数 bind()返回的函数</li>
<li>axios 作为对象有 Axios 原型上的所有方法.有 Axios 对象上所有属性</li>
</ol>
<h3 id="instance-与-axios-的区别"><a href="#instance-与-axios-的区别" class="headerlink" title="instance 与 axios 的区别?"></a>instance 与 axios 的区别?</h3><p>相同:</p>
<ul>
<li>都是一个能发任意请求的函数:request</li>
<li>都有发特定请求的方法:get post put delete</li>
<li>都有默认配置参数与拦截器属性</li>
</ul>
<p>不同:</p>
<ul>
<li>默认配置可能不一样</li>
<li>没有 create cancelToken all 方法</li>
</ul>
<h3 id="利用-工厂函数包装"><a href="#利用-工厂函数包装" class="headerlink" title="利用 工厂函数包装"></a>利用 工厂函数包装</h3><p>通过工厂函数对实例化对象过程进行包装</p>
<ul>
<li>request 方法处理</li>
<li>实例挂载<ul>
<li>this 的处理</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createInstance</span>(<span class="params">defaultConfig</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  创建Axios的实例</span></span><br><span class="line"><span class="comment">      原型对象上有一些用来发请求的方法: get()/post()/put()/delete()/request()</span></span><br><span class="line"><span class="comment">      自身上有2个重要属性: defaults/interceptors</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">var</span> context = <span class="keyword">new</span> Axios(defaultConfig);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// axios和axios.create()对应的就是request函数</span></span><br><span class="line">  <span class="comment">// 下面这句话相当于 ===&gt; Axios.prototype.request.bind(context)</span></span><br><span class="line">  <span class="keyword">var</span> instance = bind(Axios.prototype.request, context);</span><br><span class="line">   <span class="comment">// 返回新函数,新函数内部调用request,里面的this 指向 context 也就是Axios的实例</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 将Axios原型对象上的方法拷贝到instance上: request()/get()/post()/put()/delete()</span></span><br><span class="line">  <span class="comment">//===&gt; 就可以使用axios.get()</span></span><br><span class="line">  <span class="comment">//===&gt; request() === axios.request(&#123;&#125;) === axios(&#123;&#125;)</span></span><br><span class="line">  utils.extend(instance, Axios.prototype, context);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 将Axios实例对象上的属性拷贝到instance上: defaults和interceptors属性</span></span><br><span class="line">  utils.extend(instance, context);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">var</span> axios = createInstance(defaults);</span><br><span class="line">...</span><br><span class="line"><span class="comment">//源码中导出</span></span><br><span class="line"><span class="built_in">module</span>.exports = axios;</span><br></pre></td></tr></table></figure>
<h4 id="Axios-prototype-request-是什么呢"><a href="#Axios-prototype-request-是什么呢" class="headerlink" title="Axios.prototype.request 是什么呢?"></a>Axios.prototype.request 是什么呢?</h4><p>是个函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用于发请求的函数</span></span><br><span class="line"><span class="comment">//我们使用的axios就是此函数bind()返回的函数</span></span><br><span class="line">Axios.prototype.request = <span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/*eslint no-param-reassign:0*/</span></span><br><span class="line">  <span class="comment">// Allow for axios(&#x27;example/url&#x27;[, config]) a la fetch API</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> config === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">    config = <span class="built_in">arguments</span>[<span class="number">1</span>] || &#123;&#125;;</span><br><span class="line">    config.url = <span class="built_in">arguments</span>[<span class="number">0</span>];</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    config = config || &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  ....</span><br><span class="line">  <span class="comment">// 给原型对象添加 四个方法</span></span><br><span class="line">    utils.forEach([<span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;head&#x27;</span>, <span class="string">&#x27;options&#x27;</span>], <span class="function"><span class="keyword">function</span> <span class="title">forEachMethodNoData</span>(<span class="params">method</span>) </span>&#123;</span><br><span class="line">      <span class="comment">/*eslint func-names:0*/</span></span><br><span class="line">      Axios.prototype[method] = <span class="function"><span class="keyword">function</span>(<span class="params">url, config</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.request(utils.merge(config || &#123;&#125;, &#123;</span><br><span class="line">          method: method,</span><br><span class="line">          url: url</span><br><span class="line">        &#125;));</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://book.52react.cn/20200122102604.png" alt=""></p>
<h2 id="axios-调用流程"><a href="#axios-调用流程" class="headerlink" title="axios 调用流程"></a>axios 调用流程</h2><blockquote>
<p>实际是调用的 Axios.prototype.request 方法，最终返回的是 promise 链式调用，实际请求是在 dispatchRequest 中派发的。</p>
</blockquote>
<p>因为 <code>axios</code> 是对异步任务的封装，所以必不可少的，我们需要使用 <code>Promise</code> 来进行包装</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">request(config) 将请求拦截器/dispatchRequest()/响应拦截器 通过Promise链串起来,返回Promise dispatchRequest(config)</span><br><span class="line">转换请求数据 ===&gt; 调用xhrAdapter()发请求 ===&gt; 请求返回后转化响应数据,返回Promise xhrAdapter(config)</span><br><span class="line">创建XHR对象,根据config进行相应设置,发送特定请求,并接受响应数据,返回Promise request(config) ==&gt; dispatchRequest(config)</span><br><span class="line">==&gt; xhrAdapter(config)</span><br></pre></td></tr></table></figure>
<p><img src="http://book.52react.cn/20200122164443.png" alt=""></p>
<p><img src="http://book.52react.cn/20200122134727.png" alt=""></p>
<h2 id="拦截器-Interceptor-原理"><a href="#拦截器-Interceptor-原理" class="headerlink" title="拦截器 - Interceptor 原理"></a>拦截器 - Interceptor 原理</h2><blockquote>
<p>用 axios.interceptors.request.use 添加请求成功和失败拦截器函数，用 axios.interceptors.response.use 添加响应成功和失败拦截器函数。在 Axios.prototype.request 函数组成 promise 链式调用时，Interceptors.protype.forEach 遍历请求和响应拦截器添加到真正发送请求 dispatchRequest 的两端，从而做到请求前拦截和响应后拦截。拦截器也支持用 Interceptors.protype.eject 方法移除。</p>
</blockquote>
<p>给实例对象添加 <code>request</code> 和 <code>response</code> 拦截器</p>
<p>构造函数 Axios</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Axios</span>(<span class="params">instanceConfig</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 默认参数</span></span><br><span class="line">  <span class="built_in">this</span>.defaults = instanceConfig;</span><br><span class="line">  <span class="comment">// 拦截器 请求和响应拦截器</span></span><br><span class="line">  <span class="built_in">this</span>.interceptors = &#123;</span><br><span class="line">    request: <span class="keyword">new</span> InterceptorManager(),</span><br><span class="line">    response: <span class="keyword">new</span> InterceptorManager()</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Interceptor"><a href="#Interceptor" class="headerlink" title="Interceptor"></a>Interceptor</h3><p>拦截器对象，用来注册和管理拦截器</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加请求前拦截器</span></span><br><span class="line">axios.interceptors.request.use(</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加请求后拦截器</span></span><br><span class="line">axios.interceptors.response.use(</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>构造函数中 InterceptorManager 的实现</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">InterceptorManager</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.handlers = []; <span class="comment">//提供数组</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 类似与回调函数1  回调函数2</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param </span>resolvedHandler  回调函数1</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param </span>rejectedHandler  回调函数2</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">use</span>(<span class="params">resolvedHandler, rejectedHandler</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.handlers.push(&#123;</span><br><span class="line">      resolvedHandler,</span><br><span class="line">      rejectedHandler</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="InterceptorManager-prototype-forEach-遍历"><a href="#InterceptorManager-prototype-forEach-遍历" class="headerlink" title="InterceptorManager.prototype.forEach 遍历"></a>InterceptorManager.prototype.forEach 遍历</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  创建用于保存请求/响应拦截函数的数组</span></span><br><span class="line"><span class="comment">  数组的中间放发送请求的函数</span></span><br><span class="line"><span class="comment">  数组的左边放请求拦截器函数(成功/失败)</span></span><br><span class="line"><span class="comment">  数组的右边放响应拦截器函数</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">var</span> chain = [dispatchRequest, <span class="literal">undefined</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> promise = <span class="built_in">Promise</span>.resolve(config);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 后添加的请求拦截器保存在数组的前面</span></span><br><span class="line"><span class="built_in">this</span>.interceptors.request.forEach(<span class="function"><span class="keyword">function</span> <span class="title">unshiftRequestInterceptors</span>(<span class="params">interceptor</span>) </span>&#123;</span><br><span class="line">  chain.unshift(interceptor.fulfilled, interceptor.rejected);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 后添加的响应拦截器保存在数组的后面</span></span><br><span class="line"><span class="built_in">this</span>.interceptors.response.forEach(<span class="function"><span class="keyword">function</span> <span class="title">pushResponseInterceptors</span>(<span class="params">interceptor</span>) </span>&#123;</span><br><span class="line">  chain.push(interceptor.fulfilled, interceptor.rejected);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过promise的then()串连起所有的请求拦截器/请求方法/响应拦截器</span></span><br><span class="line"><span class="keyword">while</span> (chain.length) &#123;</span><br><span class="line">  promise = promise.then(chain.shift(), chain.shift());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结构<br><img src="http://book.52react.cn/20200122094434.png" alt=""></p>
<h3 id="异步任务链"><a href="#异步任务链" class="headerlink" title="异步任务链"></a>异步任务链</h3><p>把请求包装在 <code>Promise</code> 任务链中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="built_in">Promise</span>.resolve(configs);</span><br><span class="line"></span><br><span class="line"><span class="built_in">this</span>.interceptors.request.handlers.forEach(<span class="function"><span class="params">handler</span> =&gt;</span> &#123;</span><br><span class="line">  promise = promise.then(handler.resolvedHandler, handler.rejectedHandler);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">promise = promise.then(<span class="built_in">this</span>.dispatch, <span class="literal">undefined</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">this</span>.interceptors.response.handlers.forEach(<span class="function"><span class="params">handler</span> =&gt;</span> &#123;</span><br><span class="line">  promise = promise.then(handler.resolvedHandler, handler.rejectedHandler);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ol>
<li>请求和响应的拦截器可以写 Promise。</li>
<li>如果设置了多个<strong>请求</strong>响应器，<strong>后设置的先执行</strong>。</li>
<li>如果设置了多个<strong>响应</strong>拦截器，<strong>先设置的先执行</strong>。</li>
</ol>
<h2 id="axios-如何取消请求"><a href="#axios-如何取消请求" class="headerlink" title="axios 如何取消请求?"></a>axios 如何取消请求?</h2><blockquote>
<p>通过传递 config 配置 cancelToken 的形式，来取消的。判断有传 cancelToken，在 promise 链式调用的 dispatchRequest 抛出错误，在 adapter 中 request.abort()取消请求，使 promise 走向 rejected，被用户捕获取消信息。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> cancel; <span class="comment">// 用于保存取消请求的函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getProducts1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  axios(&#123;</span><br><span class="line">    url: <span class="string">&quot;http://localhost:4000/products1&quot;</span>,</span><br><span class="line">    cancelToken: <span class="keyword">new</span> axios.CancelToken(<span class="function"><span class="params">c</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// c是用于取消当前请求的函数</span></span><br><span class="line">      <span class="comment">// 保存取消函数, 用于之后可能需要取消当前请求</span></span><br><span class="line">      cancel = c;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;).then(</span><br><span class="line">    response =&gt; &#123;</span><br><span class="line">      cancel = <span class="literal">null</span>;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;请求1成功了&quot;</span>, response.data);</span><br><span class="line">    &#125;,</span><br><span class="line">    error =&gt; &#123;</span><br><span class="line">      cancel = <span class="literal">null</span>;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;请求1失败了&quot;</span>, error.message, error);</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="new-axios-CancelToken-做了什么"><a href="#new-axios-CancelToken-做了什么" class="headerlink" title="new axios.CancelToken 做了什么"></a>new axios.CancelToken 做了什么</h3><p><strong>当配置了<code>cancelToken</code>对象时</strong></p>
<ol>
<li>创建了一个用于将来取消请求的 cacelPromise</li>
<li>并定义了一个用于取消请求的 cancel 函数</li>
<li>将 cancel 函数传递出来</li>
</ol>
<p><strong>取消请求</strong></p>
<ol>
<li>执行 cancel 函数,传入错误的 message</li>
<li>内部会让 cancelPromise 变成成功,且成功的值为一个 Cancel 对象</li>
<li>在 cancelPromise 的成功回调中,中断请求,并让发请求的 promise 失败,失败的 reason 为 Cancel 对象</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CancelToken</span>(<span class="params">executor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> executor !== <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">&quot;executor must be a function.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 为将来取消请求准备一个promise对象, 并保存resolve函数</span></span><br><span class="line">  <span class="keyword">var</span> resolvePromise;</span><br><span class="line">  <span class="built_in">this</span>.promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> <span class="title">promiseExecutor</span>(<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">    resolvePromise = resolve;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 保存当前token对象</span></span><br><span class="line">  <span class="keyword">var</span> token = <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 立即执行接收的执行器函数, 并传入用于取消请求的cancel函数</span></span><br><span class="line">  executor(<span class="function"><span class="keyword">function</span> <span class="title">cancel</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 如果token中有reason了, 说明请求已取消</span></span><br><span class="line">    <span class="keyword">if</span> (token.reason) &#123;</span><br><span class="line">      <span class="comment">// Cancellation has already been requested</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 将token的reason指定为一个Cancel对象</span></span><br><span class="line">    token.reason = <span class="keyword">new</span> Cancel(message);</span><br><span class="line">    <span class="comment">// 将取消请求的promise指定为成功, 值为reason</span></span><br><span class="line">    resolvePromise(token.reason);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Cancel 对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Cancel</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.message = message;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Cancel.prototype.toString = <span class="function"><span class="keyword">function</span> <span class="title">toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;Cancel&quot;</span> + (<span class="built_in">this</span>.message ? <span class="string">&quot;: &quot;</span> + <span class="built_in">this</span>.message : <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用于标识是一个取消的error</span></span><br><span class="line">Cancel.prototype.__CANCEL__ = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = Cancel;</span><br></pre></td></tr></table></figure>
<p>在 xhr.js 中调用 CancelToken 函数中的 promise 的 then</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span> 如果配置了cancelToken</span><br><span class="line">    <span class="keyword">if</span> (config.cancelToken) &#123;</span><br><span class="line">      <span class="regexp">//</span> 指定用于中断请求的回调函数</span><br><span class="line">      config.cancelToken.promise.then(<span class="keyword">function</span> onCanceled(cancel) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!request) &#123;</span><br><span class="line">          return;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="regexp">//</span> 中断请求</span><br><span class="line">        request.abort();</span><br><span class="line">        <span class="regexp">//</span> 让请求的promise失败</span><br><span class="line">        reject(cancel);</span><br><span class="line">        <span class="regexp">//</span> Clean up request</span><br><span class="line">        request = null;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>其中 cancel 对象哪里来的呢?</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">token.reason = <span class="keyword">new</span> Cancel(message);</span><br><span class="line">resolvePromise(token.reason);</span><br></pre></td></tr></table></figure>
<h2 id="适配器-支持浏览器也支持-node-环境-Adapter"><a href="#适配器-支持浏览器也支持-node-环境-Adapter" class="headerlink" title="适配器(支持浏览器也支持 node 环境) - Adapter"></a>适配器(支持浏览器也支持 node 环境) - Adapter</h2><blockquote>
<p>axios.defaults.adapter 默认配置中根据环境判断是浏览器还是 node 环境，使用对应的适配器。适配器支持自定义。</p>
</blockquote>
<ul>
<li>browser : XMLHttpRequest / Fetch</li>
<li>node : http / https</li>
</ul>
<h2 id="数据转换"><a href="#数据转换" class="headerlink" title="数据转换"></a>数据转换</h2><p>请求数据转换 : <code>transformRequest</code></p>
<p>响应数据转换 : <code>transformResponse</code></p>
<p><code>axios.defaults.transformResponse</code> 数组中默认就有一个函数，所以使用 concat 链接自定义的函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  baseURL: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  url: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  method: <span class="string">&quot;get&quot;</span>,</span><br><span class="line">  headers: &#123;</span><br><span class="line">    <span class="string">&quot;content-type&quot;</span>: <span class="string">&quot;application/json&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  transformResponse: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//配置项对数据处理</span></span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用</span></span><br><span class="line"><span class="keyword">var</span> ISO_8601 = <span class="regexp">/(\d&#123;4&#125;-\d&#123;2&#125;-\d&#123;2&#125;)T(\d&#123;2&#125;:\d&#123;2&#125;:\d&#123;2&#125;)Z/</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">formatDate</span>(<span class="params">d</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> d.getMonth() + <span class="number">1</span> + <span class="string">&quot;/&quot;</span> + d.getDate() + <span class="string">&quot;/&quot;</span> + d.getFullYear();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 扩展配置  对响应数据格式化转换</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">data</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;any&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">axios</span><br><span class="line">  .get(<span class="string">&quot;https://api.github.com/users/mzabriskie&quot;</span>, &#123;</span><br><span class="line">    transformResponse: axios.defaults.transformResponse.concat(<span class="function"><span class="keyword">function</span>(<span class="params">data, headers</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">Object</span>.keys(data).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">k</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ISO_8601.test(data[k])) &#123;</span><br><span class="line">          data[k] = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="built_in">Date</span>.parse(data[k]));</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">return</span> data;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">&quot;created&quot;</span>).innerHTML = formatDate(res.data.created_at);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<h2 id="几个好用的工具方法"><a href="#几个好用的工具方法" class="headerlink" title="几个好用的工具方法"></a>几个好用的工具方法</h2><h3 id="deepCopy-函数"><a href="#deepCopy-函数" class="headerlink" title="- deepCopy 函数"></a>- deepCopy 函数</h3><p>基于上面说的，我们需要封装一个方法，用于深度克隆对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> deepCopy = <span class="function"><span class="params">source</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> target = <span class="built_in">Array</span>.isArray(source) ? [] : &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> source) &#123;</span><br><span class="line">    <span class="keyword">if</span> (source.hasOwnProperty(key)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> source[key] === <span class="string">&quot;object&quot;</span> &amp;&amp; source !== <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">//递归</span></span><br><span class="line">        target[key] = deepCopy(source[key]);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        target[key] = source[key];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> target;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="configMerge-函数"><a href="#configMerge-函数" class="headerlink" title="- configMerge 函数"></a>- configMerge 函数</h3><p>对于配置合并，并不能简单的进行处理，需要针对不同的配置进行不同的处理，有的是覆盖，有的合并</p>
<ul>
<li><code>baseURL</code>、<code>url</code>、 <code>method</code> 等是直接覆盖的</li>
<li><code>headers</code> 是需要进行合并处理的</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> mergeConfig = <span class="function">(<span class="params">obj1, obj2</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> target = deepCopy(obj1);</span><br><span class="line">  <span class="keyword">let</span> source = deepCopy(obj2);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">Object</span>.keys(source).reduce(<span class="function">(<span class="params">t, k</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ([<span class="string">&quot;url&quot;</span>, <span class="string">&quot;method&quot;</span>, <span class="string">&quot;baseURL&quot;</span>].includes(k)) &#123;</span><br><span class="line">      t[k] = source[k];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ([<span class="string">&quot;headers&quot;</span>].includes(k)) &#123;</span><br><span class="line">      <span class="comment">// console.log(&#x27;target&#x27;, target.headers);</span></span><br><span class="line">      <span class="comment">// console.log(&#x27;source&#x27;, source.headers);</span></span><br><span class="line">      t[k] = <span class="built_in">Object</span>.assign(target[k], source[k]);</span><br><span class="line">      <span class="comment">// console.log(&#x27;t&#x27;, t);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> t;</span><br><span class="line">  &#125;, target);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> target;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="最后看下整个流程图"><a href="#最后看下整个流程图" class="headerlink" title="最后看下整个流程图"></a>最后看下整个流程图</h2><p><img src="http://book.52react.cn/20200122112713.png" alt=""></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a class="link"   target="_blank" rel="noopener" href="https://juejin.im/post/5df349b5518825123751ba66#heading-15" >学习 axios 源码整体架构…<i class="fas fa-external-link-alt"></i></a></p>

        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    <ul>
        <li>本文标题：Axios 源码解析</li>
        <li>本文作者：Mariogogogo</li>
        <li>创建时间：2020-01-22 00:00:00</li>
        <li>
            本文链接：http://www.h5web.cc/2020/01/22/Axios源码解析/
        </li>
        <li>
            版权声明：本博客所有文章除特别声明外，均采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> 许可协议。转载请注明出处！
        </li>
    </ul>
</div>

            </div>
        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2020/02/02/%E5%B8%B8%E7%94%A8%E7%9A%84CSS%E5%B0%8F%E6%8A%80%E5%B7%A7/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">常用的 CSS 小技巧</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2020/01/22/Axios%E5%B0%81%E8%A3%85/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Axios封装</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>&nbsp;-&nbsp;
            
            2021&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">Mariogogogo</a>
        </div>
        
        <div class="theme-info info-item">
            由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.3</a>
        </div>
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A6%96%E5%85%88%E5%AF%B9-axios-%E6%8F%90%E5%87%BA%E5%87%A0%E4%B8%AA%E9%97%AE%E9%A2%98"><span class="nav-number">1.</span> <span class="nav-text">首先对 axios 提出几个问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#axios-%E7%AE%80%E4%BB%8B"><span class="nav-number">2.</span> <span class="nav-text">axios 简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#axios-%E8%BF%94%E5%9B%9E%E4%BF%A1%E6%81%AF"><span class="nav-number">3.</span> <span class="nav-text">axios 返回信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E8%A6%81%E7%82%B9"><span class="nav-number">4.</span> <span class="nav-text">知识要点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-axios-%E6%94%AF%E6%8C%81%E5%AF%B9%E8%B1%A1%E5%8F%88%E6%94%AF%E6%8C%81%E5%87%BD%E6%95%B0"><span class="nav-number">5.</span> <span class="nav-text">为什么 axios 支持对象又支持函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#axios-%E4%B8%8E-Axios-%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="nav-number">5.1.</span> <span class="nav-text">axios 与 Axios 的关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#instance-%E4%B8%8E-axios-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">5.2.</span> <span class="nav-text">instance 与 axios 的区别?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A9%E7%94%A8-%E5%B7%A5%E5%8E%82%E5%87%BD%E6%95%B0%E5%8C%85%E8%A3%85"><span class="nav-number">5.3.</span> <span class="nav-text">利用 工厂函数包装</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Axios-prototype-request-%E6%98%AF%E4%BB%80%E4%B9%88%E5%91%A2"><span class="nav-number">5.3.1.</span> <span class="nav-text">Axios.prototype.request 是什么呢?</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#axios-%E8%B0%83%E7%94%A8%E6%B5%81%E7%A8%8B"><span class="nav-number">6.</span> <span class="nav-text">axios 调用流程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8B%A6%E6%88%AA%E5%99%A8-Interceptor-%E5%8E%9F%E7%90%86"><span class="nav-number">7.</span> <span class="nav-text">拦截器 - Interceptor 原理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Interceptor"><span class="nav-number">7.1.</span> <span class="nav-text">Interceptor</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#InterceptorManager-prototype-forEach-%E9%81%8D%E5%8E%86"><span class="nav-number">7.2.</span> <span class="nav-text">InterceptorManager.prototype.forEach 遍历</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1%E9%93%BE"><span class="nav-number">7.3.</span> <span class="nav-text">异步任务链</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#axios-%E5%A6%82%E4%BD%95%E5%8F%96%E6%B6%88%E8%AF%B7%E6%B1%82"><span class="nav-number">8.</span> <span class="nav-text">axios 如何取消请求?</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#new-axios-CancelToken-%E5%81%9A%E4%BA%86%E4%BB%80%E4%B9%88"><span class="nav-number">8.1.</span> <span class="nav-text">new axios.CancelToken 做了什么</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%82%E9%85%8D%E5%99%A8-%E6%94%AF%E6%8C%81%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B9%9F%E6%94%AF%E6%8C%81-node-%E7%8E%AF%E5%A2%83-Adapter"><span class="nav-number">9.</span> <span class="nav-text">适配器(支持浏览器也支持 node 环境) - Adapter</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2"><span class="nav-number">10.</span> <span class="nav-text">数据转换</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%A0%E4%B8%AA%E5%A5%BD%E7%94%A8%E7%9A%84%E5%B7%A5%E5%85%B7%E6%96%B9%E6%B3%95"><span class="nav-number">11.</span> <span class="nav-text">几个好用的工具方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#deepCopy-%E5%87%BD%E6%95%B0"><span class="nav-number">11.1.</span> <span class="nav-text">- deepCopy 函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#configMerge-%E5%87%BD%E6%95%B0"><span class="nav-number">11.2.</span> <span class="nav-text">- configMerge 函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%80%E5%90%8E%E7%9C%8B%E4%B8%8B%E6%95%B4%E4%B8%AA%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="nav-number">12.</span> <span class="nav-text">最后看下整个流程图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">13.</span> <span class="nav-text">参考</span></a></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>



<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/dark-light-toggle.js"></script>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/local-search.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/code-copy.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/lazyload.js"></script>


<div class="post-scripts">
    
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/left-side-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/toc.js"></script>
    
</div>



</body>
</html>
