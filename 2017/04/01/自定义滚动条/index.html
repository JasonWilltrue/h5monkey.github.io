<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/images/icons/favicon-16x16.png?v=2.6.2" type="image/png" sizes="16x16"><link rel="icon" href="/images/icons/favicon-32x32.png?v=2.6.2" type="image/png" sizes="32x32"><meta name="description" content="困扰的问题之一 clientHeight和offsetHeight的值由什么决定？假如我们有以下的DIV，主要显示的文字为”This is the main body of DIV”">
<meta property="og:type" content="article">
<meta property="og:title" content="自定义滚动条">
<meta property="og:url" content="http://mariogogogo.github.io/2017/04/01/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%BB%9A%E5%8A%A8%E6%9D%A1/index.html">
<meta property="og:site_name" content="Mario">
<meta property="og:description" content="困扰的问题之一 clientHeight和offsetHeight的值由什么决定？假如我们有以下的DIV，主要显示的文字为”This is the main body of DIV”">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://book.52react.cn/book/180807/j5i2697fF0.gif">
<meta property="og:image" content="http://book.52react.cn/book/180807/91KliGHjij.jpg">
<meta property="og:image" content="http://book.52react.cn/book/180807/C3h985gm7d.gif">
<meta property="article:published_time" content="2017-03-31T16:00:00.000Z">
<meta property="article:modified_time" content="2020-09-16T09:07:17.000Z">
<meta property="article:author" content="Codding">
<meta property="article:tag" content="Javascript">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://book.52react.cn/book/180807/j5i2697fF0.gif"><title>自定义滚动条 | Mario</title><link ref="canonical" href="http://mariogogogo.github.io/2017/04/01/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%BB%9A%E5%8A%A8%E6%9D%A1/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.6.2"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: ["google","bing","baidu"],
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: undefined,
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"light","wordWrap":true},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"复制","copySuccess":"复制成功","copyError":"复制失败"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 5.3.0"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner header-inner--height header-inner--bgcolor"><nav class="header-nav header-nav--sticky"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">首页</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/面试/"><span class="header-nav-menu-item__icon"><i class="fa fa-code"></i></span><span class="header-nav-menu-item__text">面试</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/算法/"><span class="header-nav-menu-item__icon"><i class="fa fa-tree"></i></span><span class="header-nav-menu-item__text">算法</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="javascript:;" onclick="return false;"><span class="header-nav-menu-item__icon"><i class="fa(s|r|l|d|b) fa fa-list"></i></span><span class="header-nav-menu-item__text">更多</span></a><div class="header-nav-submenu"><div class="header-nav-submenu-item"><a class="header-nav-submenu-item__link" href="/archives/"><span class="header-nav-submenu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-submenu-item__text">归档</span></a></div><div class="header-nav-submenu-item"><a class="header-nav-submenu-item__link" href="/categories/"><span class="header-nav-submenu-item__icon"><i class="fa fa-hourglass-start"></i></span><span class="header-nav-submenu-item__text">分类</span></a></div><div class="header-nav-submenu-item"><a class="header-nav-submenu-item__link" href="/tags/"><span class="header-nav-submenu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-submenu-item__text">标签</span></a></div><div class="header-nav-submenu-item"><a class="header-nav-submenu-item__link" href="/about/"><span class="header-nav-submenu-item__icon"><i class="fa fa-user-circle"></i></span><span class="header-nav-submenu-item__text">关于</span></a></div></div></div></div><div class="header-nav-search"><span class="header-nav-search__icon"><i class="fas fa-search"></i></span><span class="header-nav-search__text">搜索</span></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">自定义滚动条</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2017-04-01</span></span><span class="post-meta-item post-meta-item--wordcount"><span class="post-meta-item__icon"><i class="far fa-file-word"></i></span><span class="post-meta-item__info">字数统计</span><span class="post-meta-item__value">1.6k</span></span><span class="post-meta-item post-meta-item--readtime"><span class="post-meta-item__icon"><i class="far fa-clock"></i></span><span class="post-meta-item__info">阅读时长</span><span class="post-meta-item__value">18分</span></span></div></header><div class="post-body"><p>困扰的问题之一 clientHeight和offsetHeight的值由什么决定？<br>假如我们有以下的DIV，主要显示的文字为”This is the main body of DIV”<br><a id="more"></a><br>首先了解一下<br>如下图所示，</p>
<ul>
<li style="list-style: none"><input type="checkbox" checked></input> <strong>clientHeight的值由DIV内容的实际高度和CSS中的padding值决定，</strong></li>
<li style="list-style: none"><input type="checkbox" checked></input> <strong>offsetHeight的值由DIV内容的实际高度，CSS中的padding值，</strong></li>
<li style="list-style: none"><input type="checkbox" checked></input> <strong>scrollbar的高度和DIV的border值决定；至于CSS中的margin值，则不会影响clientHeight和offsetHeight的值。</strong></li>
</ul>
<p>效果图：<br><img src="http://book.52react.cn/book/180807/j5i2697fF0.gif" alt="mark"></p>
<p>分析图<br><img src="http://book.52react.cn/book/180807/91KliGHjij.jpg" alt="mark"></p>
<p><img src="http://book.52react.cn/book/180807/C3h985gm7d.gif" alt="mark"></p>

        <h2 id="代码"   >
          <a href="#代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#代码" class="headerlink" title="代码"></a>代码</h2>
      <figure class="highlight css"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">    *&#123;</span><br><span class="line">        <span class="attribute">margin</span>:<span class="number">0</span>;</span><br><span class="line">        <span class="attribute">padding</span>:<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-tag">body</span>&#123;</span><br><span class="line">        <span class="attribute">overflow</span>:hidden;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-id">#box</span>&#123;</span><br><span class="line">        <span class="attribute">float</span><span class="selector-pseudo">:right</span>;</span><br><span class="line">        <span class="attribute">top</span>:<span class="number">0</span>;</span><br><span class="line">        <span class="attribute">right</span>:<span class="number">0px</span>;</span><br><span class="line">        <span class="attribute">width</span>:<span class="number">20px</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">        <span class="attribute">background</span>:<span class="number">#ccc</span>;</span><br><span class="line">        <span class="attribute">position</span>:relative;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-id">#drag</span>&#123;</span><br><span class="line">        <span class="attribute">position</span>: absolute;</span><br><span class="line">        <span class="attribute">top</span>:<span class="number">0</span>;</span><br><span class="line">        <span class="attribute">left</span>:<span class="number">0</span>;</span><br><span class="line">        <span class="attribute">width</span>:<span class="number">20px</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">20px</span>;</span><br><span class="line">        <span class="attribute">background</span>:green;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-id">#content</span>&#123;</span><br><span class="line">        <span class="attribute">position</span>:absolute;</span><br><span class="line">        <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">400px</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">        <span class="attribute">border</span>: <span class="number">1px</span> solid black;</span><br><span class="line">        <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-id">#text</span>&#123;</span><br><span class="line">        <span class="attribute">position</span>:absolute;</span><br><span class="line">        <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></div></figure>
<figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--滚动条--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;drag&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--  //内容主容器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--内容容器--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;text&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background:#ccc;width: 120px; &quot;</span>&gt;</span></span><br><span class="line">Although many people talk about the super performance of quantum computing, such as one second to complete the current supercomputer computing tasks for several years, but so far did not create a true sense of the quantum computer, one of the very important reason is that, The state of particles used in quantum computation is not stable, and any electromagnetic or physical interference can easily disrupt its work. The state of the Mayola fermion is very stable, which makes it a perfect choice for making quantum computers. Six months ago in the laboratory of Shanghai Jiaotong University, Jia Jinfeng successfully captured it.</span><br><span class="line">Speaking of the scene, Jia Jinfeng said: &quot;In fact, I started to hear the Mayolana fermions, I think this thing may not be done 20 years out.</span><br><span class="line">Using a special material preparation method, Jia Jinfeng&#x27;s research team has grown topological insulators on the superconductors with thickness of 5 nanometers. The topological superconductor materials are prepared and finally the Mayolana fermions are found at the interface of the topological superconductors. The mysterious particles were captured 80 years, but also let Jia Jinfeng more firm with its confidence in the manufacture of quantum computers.</span><br><span class="line">Speaking of the future of the plan, Jia Jinfeng said: &quot;I hope to within a few years to do the topological quantum bit!&quot; (Before) the world has not, so if we cut into this from the point, we are the same with the world The starting line, for our country, this is able to catch up with the footsteps of quantum computing, a starting point.</span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

        <h2 id="js部分"   >
          <a href="#js部分" class="heading-link"><i class="fas fa-link"></i></a><a href="#js部分" class="headerlink" title="js部分"></a>js部分</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line"><span class="built_in">window</span>.onload=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> oBox=<span class="built_in">document</span>.getElementById(<span class="string">&#x27;box&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> oDrag=<span class="built_in">document</span>.getElementById(<span class="string">&#x27;drag&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> content=<span class="built_in">document</span>.getElementById(<span class="string">&#x27;content&#x27;</span>);<span class="comment">//内容主容器</span></span><br><span class="line">    <span class="keyword">var</span> oText = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;text&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> conHeight=content.clientHeight  </span><br><span class="line">    <span class="keyword">var</span> textHeight = oText.clientHeight</span><br><span class="line">    oDrag.onmousedown=<span class="function"><span class="keyword">function</span> (<span class="params">ev</span>)</span>&#123;</span><br><span class="line">        <span class="comment">//阻止默认事件</span></span><br><span class="line">        <span class="keyword">var</span> e=ev||<span class="built_in">window</span>.event;</span><br><span class="line">        <span class="keyword">if</span> (e.preventDefault) &#123;</span><br><span class="line">            e.preventDefault();</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            e.returnValue=<span class="literal">false</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">         <span class="comment">//e.clientY鼠标当前坐标</span></span><br><span class="line">        <span class="keyword">var</span> downY=e.clientY-oDrag.offsetTop;</span><br><span class="line">        <span class="comment">//滑块滚动最大距离</span></span><br><span class="line">        <span class="keyword">var</span> maxTop = oBox.clientHeight-oDrag.clientHeight</span><br><span class="line">        <span class="built_in">document</span>.onmousemove=<span class="function"><span class="keyword">function</span> (<span class="params">ev</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> e=ev||<span class="built_in">window</span>.event;</span><br><span class="line">            <span class="keyword">var</span> top=e.clientY-downY;</span><br><span class="line">            <span class="keyword">if</span> (top&lt;=<span class="number">0</span>) &#123;</span><br><span class="line">                top=<span class="number">0</span>;</span><br><span class="line">            &#125;;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (top&gt;=maxTop) &#123;</span><br><span class="line">                top=maxTop;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">var</span> scale=top/maxTop;</span><br><span class="line">            <span class="keyword">var</span> contentY=scale*(conHeight-textHeight);</span><br><span class="line">            oDrag.style.top=top+<span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">            oText.style.top=contentY+<span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">document</span>.onmouseup=<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="built_in">document</span>.onmousemove=<span class="built_in">document</span>.onmousemove=<span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> str=<span class="built_in">window</span>.navigator.userAgent.toLowerCase();</span><br><span class="line">    <span class="comment">//火狐浏览器</span></span><br><span class="line">    <span class="keyword">if</span> (str.indexOf(<span class="string">&#x27;firefox&#x27;</span>)!=-<span class="number">1</span>)&#123;</span><br><span class="line">         <span class="built_in">document</span>.addEventListener(<span class="string">&#x27;DOMMouseScroll&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">e</span>)</span>&#123;</span><br><span class="line">            e.preventDefault();<span class="comment">//阻止窗口默认的滚动事件</span></span><br><span class="line">            <span class="keyword">if</span> (e.detail&lt;<span class="number">0</span>) &#123;    <span class="comment">//向上滚动    div向下滚动</span></span><br><span class="line">                <span class="keyword">var</span> scrollHei=oText.offsetTop+<span class="number">25</span>;</span><br><span class="line">                <span class="keyword">if</span> (scrollHei&gt;=<span class="number">0</span>) &#123;</span><br><span class="line">                    scrollHei=<span class="number">0</span>;</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="keyword">if</span> (scrollHei&lt;=-(textHeight-conHeight)) &#123;</span><br><span class="line">                    scrollHei=-(textHeight-conHeight);</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="keyword">var</span> scale=scrollHei/(textHeight-conHeight);</span><br><span class="line">                <span class="keyword">var</span> top=scale*(oBox.clientHeight-oDrag.clientHeight);</span><br><span class="line">                oText.style.top=scrollHei+<span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">                oDrag.style.top=-top+<span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (e.detail&gt;<span class="number">0</span>) &#123;   <span class="comment">//向下滚动    div向上滚动</span></span><br><span class="line">                <span class="keyword">var</span> scrollHei=oText.offsetTop-<span class="number">25</span>;</span><br><span class="line">                <span class="keyword">if</span> (scrollHei&gt;=<span class="number">0</span>) &#123;</span><br><span class="line">                    scrollHei=<span class="number">0</span>;</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="keyword">if</span> (scrollHei&lt;=-(textHeight-conHeight)) &#123;</span><br><span class="line">                    scrollHei=-(textHeight-conHeight);</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="keyword">var</span> scale=scrollHei/(textHeight-content.clientHeight);</span><br><span class="line">                <span class="keyword">var</span> top=scale*(oBox.clientHeight-oDrag.clientHeight);</span><br><span class="line">                oText.style.top=scrollHei+<span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">                oDrag.style.top=-top+<span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;,<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;<span class="comment">//非火狐浏览器</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;非火狐浏览器&quot;</span>)</span><br><span class="line">        <span class="built_in">document</span>.onmousewheel=<span class="function"><span class="keyword">function</span> (<span class="params">ev</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> e=ev||<span class="built_in">window</span>.event;</span><br><span class="line">            <span class="keyword">if</span> (e.preventDefault) &#123;</span><br><span class="line">                e.preventDefault();</span><br><span class="line">            &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                e.returnValue=<span class="literal">false</span>;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">if</span> (e.wheelDelta&gt;<span class="number">0</span>) &#123;  <span class="comment">//向上滚动    此时div向下移动</span></span><br><span class="line">                <span class="keyword">var</span> scrollHei=oText.offsetTop+<span class="number">25</span>;</span><br><span class="line">                <span class="keyword">if</span> (scrollHei&gt;=<span class="number">0</span>) &#123;</span><br><span class="line">                    scrollHei=<span class="number">0</span>;</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="keyword">if</span> (scrollHei&lt;=-(textHeight-conHeight)) &#123;</span><br><span class="line">                    scrollHei=-(textHeight-conHeight);</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="keyword">var</span> scale=scrollHei/(textHeight-conHeight);</span><br><span class="line">                <span class="keyword">var</span> top=scale*(oBox.clientHeight-oDrag.clientHeight);</span><br><span class="line">                oText.style.top=scrollHei+<span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">                oDrag.style.top=-top+<span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">if</span> (e.wheelDelta&lt;<span class="number">0</span>) &#123;  <span class="comment">//向下</span></span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;下&quot;</span>)</span><br><span class="line">                <span class="keyword">var</span> scrollHei=oText.offsetTop-<span class="number">25</span>;</span><br><span class="line">                <span class="keyword">if</span> (scrollHei&gt;=<span class="number">0</span>) &#123;</span><br><span class="line">                    scrollHei=<span class="number">0</span>;</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="keyword">if</span> (scrollHei&lt;=-(textHeight-conHeight)) &#123;</span><br><span class="line">                    scrollHei=-(textHeight-conHeight);</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="keyword">var</span> scale=scrollHei/(textHeight-conHeight);</span><br><span class="line">                <span class="keyword">var</span> top=scale*(oBox.clientHeight-oDrag.clientHeight);</span><br><span class="line">                oText.style.top=scrollHei+<span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">                oDrag.style.top=-top+<span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

        <h2 id="全屏模式下"   >
          <a href="#全屏模式下" class="heading-link"><i class="fas fa-link"></i></a><a href="#全屏模式下" class="headerlink" title="全屏模式下"></a>全屏模式下</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line"><span class="built_in">window</span>.onload=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> oBox=<span class="built_in">document</span>.getElementById(<span class="string">&#x27;box&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> oDrag=<span class="built_in">document</span>.getElementById(<span class="string">&#x27;drag&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> content=<span class="built_in">document</span>.getElementById(<span class="string">&#x27;content&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> viewHeight=<span class="built_in">document</span>.documentElement.clientHeight;</span><br><span class="line">    <span class="keyword">var</span> conHeight=content.clientHeight</span><br><span class="line">    oBox.style.height=viewHeight+<span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">    oDrag.style.height=viewHeight/conHeight*viewHeight+<span class="string">&#x27;px&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">window</span>.onresize = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        viewHeight=<span class="built_in">document</span>.documentElement.clientHeight;</span><br><span class="line">        oBox.style.height=viewHeight+<span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">        oDrag.style.height=viewHeight/conHeight*viewHeight+<span class="string">&#x27;px&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        oDrag.style.top=-content.offsetTop/(content.clientHeight-viewHeight)*(oBox.clientHeight-oDrag.clientHeight)+<span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    oDrag.onmousedown=<span class="function"><span class="keyword">function</span> (<span class="params">ev</span>)</span>&#123;</span><br><span class="line">        <span class="comment">//阻止默认事件</span></span><br><span class="line">        <span class="keyword">var</span> e=ev||<span class="built_in">window</span>.event;</span><br><span class="line">        <span class="keyword">if</span> (e.preventDefault) &#123;</span><br><span class="line">            e.preventDefault();</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            e.returnValue=<span class="literal">false</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">         <span class="comment">//e.clientY鼠标当前坐标</span></span><br><span class="line">        <span class="keyword">var</span> downY=e.clientY-oDrag.offsetTop;</span><br><span class="line">       </span><br><span class="line">        <span class="built_in">document</span>.onmousemove=<span class="function"><span class="keyword">function</span> (<span class="params">ev</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> e=ev||<span class="built_in">window</span>.event;</span><br><span class="line">            <span class="keyword">var</span> top=e.clientY-downY;</span><br><span class="line">            <span class="keyword">if</span> (top&lt;=<span class="number">0</span>) &#123;</span><br><span class="line">                top=<span class="number">0</span>;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">if</span> (top&gt;=oBox.clientHeight-oDrag.clientHeight) &#123;</span><br><span class="line">                top=oBox.clientHeight-oDrag.clientHeight;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">var</span> scale=top/(oBox.clientHeight-oDrag.clientHeight);</span><br><span class="line">            <span class="keyword">var</span> contentY=scale*(content.clientHeight-viewHeight);</span><br><span class="line">            oDrag.style.top=top+<span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">            content.style.top=-contentY+<span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">document</span>.onmouseup=<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="built_in">document</span>.onmousemove=<span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> str=<span class="built_in">window</span>.navigator.userAgent.toLowerCase();</span><br><span class="line">    <span class="comment">//火狐浏览器</span></span><br><span class="line">    <span class="keyword">if</span> (str.indexOf(<span class="string">&#x27;firefox&#x27;</span>)!=-<span class="number">1</span>)&#123;</span><br><span class="line">         <span class="built_in">document</span>.addEventListener(<span class="string">&#x27;DOMMouseScroll&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">e</span>)</span>&#123;</span><br><span class="line">            e.preventDefault();<span class="comment">//阻止窗口默认的滚动事件</span></span><br><span class="line">            <span class="keyword">if</span> (e.detail&lt;<span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> scrollHei=content.offsetTop+<span class="number">25</span>;</span><br><span class="line">                <span class="keyword">if</span> (scrollHei&gt;=<span class="number">0</span>) &#123;</span><br><span class="line">                    scrollHei=<span class="number">0</span>;</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="keyword">if</span> (scrollHei&lt;=-(content.clientHeight-viewHeight)) &#123;</span><br><span class="line">                    scrollHei=-(content.clientHeight-viewHeight);</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="keyword">var</span> scale=scrollHei/(content.clientHeight-viewHeight);</span><br><span class="line">                <span class="keyword">var</span> top=scale*(oBox.clientHeight-oDrag.clientHeight);</span><br><span class="line">                content.style.top=scrollHei+<span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">                oDrag.style.top=-top+<span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (e.detail&gt;<span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> scrollHei=content.offsetTop-<span class="number">25</span>;</span><br><span class="line">                <span class="keyword">if</span> (scrollHei&gt;=<span class="number">0</span>) &#123;</span><br><span class="line">                    scrollHei=<span class="number">0</span>;</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="keyword">if</span> (scrollHei&lt;=-(content.clientHeight-viewHeight)) &#123;</span><br><span class="line">                    scrollHei=-(content.clientHeight-viewHeight);</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="keyword">var</span> scale=scrollHei/(content.clientHeight-viewHeight);</span><br><span class="line">                <span class="keyword">var</span> top=scale*(oBox.clientHeight-oDrag.clientHeight);</span><br><span class="line">                content.style.top=scrollHei+<span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">                oDrag.style.top=-top+<span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;,<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;<span class="comment">//非火狐浏览器</span></span><br><span class="line">        <span class="built_in">document</span>.onmousewheel=<span class="function"><span class="keyword">function</span> (<span class="params">ev</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> e=ev||<span class="built_in">window</span>.event;</span><br><span class="line">            <span class="keyword">if</span> (e.preventDefault) &#123;</span><br><span class="line">                e.preventDefault();</span><br><span class="line">            &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                e.returnValue=<span class="literal">false</span>;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">if</span> (e.wheelDelta&gt;<span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> scrollHei=content.offsetTop+<span class="number">25</span>;</span><br><span class="line">                <span class="keyword">if</span> (scrollHei&gt;=<span class="number">0</span>) &#123;</span><br><span class="line">                    scrollHei=<span class="number">0</span>;</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="keyword">if</span> (scrollHei&lt;=-(content.clientHeight-viewHeight)) &#123;</span><br><span class="line">                    scrollHei=-(content.clientHeight-viewHeight);</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="keyword">var</span> scale=scrollHei/(content.clientHeight-viewHeight);</span><br><span class="line">                <span class="keyword">var</span> top=scale*(oBox.clientHeight-oDrag.clientHeight);</span><br><span class="line">                content.style.top=scrollHei+<span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">                oDrag.style.top=-top+<span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">if</span> (e.wheelDelta&lt;<span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> scrollHei=content.offsetTop-<span class="number">25</span>;</span><br><span class="line">                <span class="keyword">if</span> (scrollHei&gt;=<span class="number">0</span>) &#123;</span><br><span class="line">                    scrollHei=<span class="number">0</span>;</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="keyword">if</span> (scrollHei&lt;=-(content.clientHeight-viewHeight)) &#123;</span><br><span class="line">                    scrollHei=-(content.clientHeight-viewHeight);</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="keyword">var</span> scale=scrollHei/(content.clientHeight-viewHeight);</span><br><span class="line">                <span class="keyword">var</span> top=scale*(oBox.clientHeight-oDrag.clientHeight);</span><br><span class="line">                content.style.top=scrollHei+<span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">                oDrag.style.top=-top+<span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure></div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ 本文结束，感谢您的阅读 ------</div></div><div class="post-copyright copyright"><div class="copyright-author"><span class="copyright-author__name">本文作者: </span><span class="copyright-author__value"><a href="http://mariogogogo.github.io">Codding</a></span></div><div class="copyright-link"><span class="copyright-link__name">本文链接: </span><span class="copyright-link__value"><a href="http://mariogogogo.github.io/2017/04/01/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%BB%9A%E5%8A%A8%E6%9D%A1/">http://mariogogogo.github.io/2017/04/01/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%BB%9A%E5%8A%A8%E6%9D%A1/</a></span></div><div class="copyright-notice"><span class="copyright-notice__name">版权声明: </span><span class="copyright-notice__value">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="external nofollow" target="_blank">BY-NC-SA</a> 许可协议。转载请注明出处！</span></div></div><div class="post-tags"><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="http://mariogogogo.github.io/tags/Javascript/">Javascript</a></span></div><nav class="post-paginator paginator"><div class="paginator-prev"><a class="paginator-prev__link" href="/2017/05/07/%E7%94%A8JS%E8%8E%B7%E5%8F%96%E5%B0%8F%E6%95%B0%E7%82%B9%E5%90%8E%E4%B8%A4%E4%BD%8D%E6%95%B0%E5%AD%97%E6%96%B9%E6%B3%95/"><span class="paginator-prev__icon"><i class="fas fa-angle-left"></i></span><span class="paginator-prev__text">用JS获取小数点后两位数字方法</span></a></div><div class="paginator-next"><a class="paginator-next__link" href="/2016/06/08/Javascript%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B%E5%88%9D%E6%8E%A2%EF%BC%88%E4%B8%80%EF%BC%89---%20%E5%B0%81%E8%A3%85/"><span class="paginator-prev__text">Javascript 面向对象编程初探（一）--- 封装</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div><div class="comments" id="comments"><div id="valine-container"></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">文章目录</span><span class="sidebar-nav-ov">站点概览</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81"><span class="toc-number">1.</span> <span class="toc-text">
          代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#js%E9%83%A8%E5%88%86"><span class="toc-number">2.</span> <span class="toc-text">
          js部分</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E5%B1%8F%E6%A8%A1%E5%BC%8F%E4%B8%8B"><span class="toc-number">3.</span> <span class="toc-text">
          全屏模式下</span></a></li></ol></section><!-- ov = overview--><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1610542142,718703573&amp;fm=26&amp;gp=0.jpg" alt="avatar"></div><p class="sidebar-ov-author__text">热爱生活，热爱代码</p></div><div class="sidebar-ov-social"><a class="sidebar-ov-social-item" href="https://github.com/" target="_blank" rel="noopener" data-popover="Github" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-github"></i></span></a><a class="sidebar-ov-social-item" href="https://plus.google.com/" target="_blank" rel="noopener" data-popover="Google" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-google"></i></span></a><a class="sidebar-ov-social-item" href="https://twitter.com/" target="_blank" rel="noopener" data-popover="Twitter" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-twitter"></i></span></a><a class="sidebar-ov-social-item" href="https://youtube.com/" target="_blank" rel="noopener" data-popover="Youtube" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-youtube"></i></span></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="知识共享许可协议" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">你已阅读了 </span><span class="sidebar-reading-info__num">0</span><span class="sidebar-reading-info__perc">%</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2021</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>Codding</span></div><div><span>由 <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a> 强力驱动</span><span> v5.3.0</span><span class="footer__devider">|</span><span>主题 - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.6.2</span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><div class="search-mask"></div><div class="search-popup"><span class="search-close"></span><div class="search-input"><input placeholder="搜索文章（支持多关键词，请用空格分隔）"><div class="search-btns">使用搜索：<span class="search-btns-item search-btns-item--google"><i class="fab fa-google"></i>谷歌</span><span class="search-btns-item search-btns-item--bing"><i></i>必应</span><span class="search-btns-item search-btns-item--baidu"><i></i>百度</span></div></div><div class="search-results"></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script>function initSearch() {
  var isXML = true;
  var search_path = 'search.xml';

  if (!search_path) {
    search_path = 'search.xml';
  } else if (/json$/i.test(search_path)) {
    isXML = false;
  }

  var path = '/' + search_path;
  $.ajax({
    url: path,
    dataType: isXML ? 'xml' : 'json',
    async: true,
    success: function (res) {
      var datas = isXML ? $('entry', res).map(function () {
        // 将 XML 转为 JSON
        return {
          title: $('title', this).text(),
          content: $('content', this).text(),
          url: $('url', this).text()
        };
      }).get() : res;
      var $input = $('.search-input input');
      var $result = $('.search-results');
      // 搜索对象（标题、内容）的权重，影响显示顺序
      var WEIGHT = { title: 100, content: 1 };
      var searchPost = function () {
        var searchText = $input.val().toLowerCase().trim();
        // 根据空白字符分隔关键字
        var keywords = searchText.split(/[\s]+/);
        // 搜索结果
        var matchPosts = [];

        // 有多个关键字时，将原文字整个保存下来
        if (keywords.length > 1) {
          keywords.push(searchText);
        }
        // 防止未输入字符时搜索
        if (searchText.length > 0) {
          datas.forEach(function (data) {
            var isMatch  = false;
            // 没有标题的文章使用预设的 i18n 变量代替
            var title = (data.title && data.title.trim()) || '[ 文章无标题 ]';
            var titleLower = title && title.toLowerCase();
            // 删除 HTML 标签 和 所有空白字符
            var content = data.content && data.content.replace(/<[^>]+>/g, '');
            var contentLower = content && content.toLowerCase();
            // 删除重复的 /
            var postURL = data.url && decodeURI(data.url).replace(/\/{2,}/g, '/');
            // 标题中匹配到的关键词
            var titleHitSlice = [];
            // 内容中匹配到的关键词
            var contentHitSlice = [];

            keywords.forEach(function (keyword) {
              /**
              * 获取匹配的关键词的索引
              * @param {String} keyword 要匹配的关键字
              * @param {String} text 原文字
              * @param {Boolean} caseSensitive 是否区分大小写
              * @param {Number} weight 匹配对象的权重。权重大的优先显示
              * @return {Array}
              */
              function getIndexByword (word, text, caseSensitive, weight) {
                if (!word || !text) {
                  return [];
                };

                var startIndex = 0; // 每次匹配的开始索引
                var index = -1;     // 匹配到的索引值
                var result = [];    // 匹配结果

                if (!caseSensitive) {
                  word = word.toLowerCase();
                  text = text.toLowerCase();
                }

                while((index = text.indexOf(word, startIndex)) !== -1) {
                  var hasMatch = false;
                  // 索引位置相同的关键词，保留长度较长的
                  titleHitSlice.forEach(function (hit) {
                    if (hit.index === index && hit.word.length < word.length) {
                      hit.word = word;
                      hasMatch = true;
                    }
                  });
                  startIndex = index + word.length;
                  !hasMatch && result.push({ index: index, word: word, weight: weight });
                }
                return result;
              }
              titleHitSlice = titleHitSlice.concat(getIndexByword(keyword, titleLower, false, WEIGHT.title));
              contentHitSlice = contentHitSlice.concat(getIndexByword(keyword, contentLower, false, WEIGHT.content));
            });

            var hitTitle = titleHitSlice.length;
            var hitContent = contentHitSlice.length;

            if (hitTitle > 0 || hitContent > 0) {
              isMatch = true;
            }
            if (isMatch) {
              ;[titleHitSlice, contentHitSlice].forEach(function (hit) {
                // 按照匹配文字的索引的递增顺序排序
                hit.sort(function (left, right) {
                  return left.index - right.index;
                });
              });
              /**
              * 给文本中匹配到的关键词添加标记，从而进行高亮显示
              * @param {String} text 原文本
              * @param {Array} hitSlice 匹配项的索引信息
              * @param {Number} start 开始索引
              * @param {Number} end 结束索引
              * @return {String}
              */
              function highlightKeyword (text, hitSlice, start, end) {
                if (!text || !hitSlice || !hitSlice.length) {
                  return;
                }

                var result = '';
                var startIndex = start;
                var endIndex = end;
                hitSlice.forEach(function (hit) {
                  if (hit.index < startIndex) {
                    return;
                  }

                  var hitWordEnd = hit.index + hit.word.length;
                  result += text.slice(startIndex, hit.index);
                  result += '<b>' + text.slice(hit.index, hitWordEnd) + '</b>';
                  startIndex = hitWordEnd;
                });
                result += text.slice(startIndex, endIndex);
                return result;
              }

              var postData = {};
              // 文章总的搜索权重
              var postWeight = titleHitSlice.length * WEIGHT.title + contentHitSlice.length * WEIGHT.content;
              // 标记匹配关键词后的标题
              var postTitle = highlightKeyword(title, titleHitSlice, 0, title.length) || title;
              // 标记匹配关键词后的内容
              var postContent;
              // 显示内容的长度
              var SHOW_WORD_LENGTH = 200;
              // 命中关键词前的字符显示长度
              var SHOW_WORD_FRONT_LENGTH = 20;
              var SHOW_WORD_END_LENGTH = SHOW_WORD_LENGTH - SHOW_WORD_FRONT_LENGTH;

              // 截取匹配的第一个字符，前后共 200 个字符来显示
              if (contentHitSlice.length > 0) {
                var firstIndex = contentHitSlice[0].index;
                var start = firstIndex > SHOW_WORD_FRONT_LENGTH ? firstIndex - SHOW_WORD_FRONT_LENGTH : 0;
                var end = firstIndex + SHOW_WORD_END_LENGTH;
                postContent = highlightKeyword(content, contentHitSlice, start, end);
              } else { // 未匹配到内容，直接截取前 200 个字符来显示
                postContent = content.slice(0, SHOW_WORD_LENGTH);
              }
              postData.title = postTitle;
              postData.content = postContent;
              postData.url = postURL;
              postData.weight = postWeight;
              matchPosts.push(postData);
            }
          });
        }

        var resultInnerHtml = '';
        if (matchPosts.length) {
          // 按权重递增的顺序排序，使权重大的优先显示
          matchPosts.sort(function (left, right) {
            return right.weight - left.weight;
          });
          resultInnerHtml += '<ul>';
          matchPosts.forEach(function (post) {
            resultInnerHtml += '<li><a class="search-results-title" href="' + post.url + '">';
            resultInnerHtml += post.title;
            resultInnerHtml += '</a><div class="search-results-content">';
            resultInnerHtml += post.content;
            resultInnerHtml += '</div></li>';
          });
          resultInnerHtml += '</ul>';
        } else {
          resultInnerHtml += '<div class="search-results-none"><i class="far fa-meh"></i></div>';
        }
        $result.html(resultInnerHtml);
      };
      $input.on('input', searchPost);
      $input.on('keyup', function (e) {
        if (e.keyCode === Stun.utils.codeToKeyCode('Enter')) {
          searchPost();
        }
      });
    }
  });
}

function closeSearch () {
  $('body').css({ overflow: 'auto' });
  $('.search-popup').css({ display: 'none' });
  $('.search-mask').css({ display: 'none' });
}

window.addEventListener('DOMContentLoaded', function () {
  Stun.utils.pjaxReloadLocalSearch = function () {
    $('.header-nav-search').on('click', function (e) {
      e.stopPropagation();
      $('body').css('overflow', 'hidden');
      $('.search-popup')
        .velocity('stop')
        .velocity('transition.expandIn', {
          duration: 300,
          complete: function () {
            $('.search-popup input').focus();
          }
        });
      $('.search-mask')
        .velocity('stop')
        .velocity('transition.fadeIn', {
          duration: 300
        });

      initSearch();
    });
    $('.search-mask, .search-close').on('click', function () {
      closeSearch();
    });
    $(document).on('keydown', function (e) {
      // Escape <=> 27
      if (e.keyCode === Stun.utils.codeToKeyCode('Escape')) {
        closeSearch();
      }
    });
  };

  Stun.utils.pjaxReloadLocalSearch();
}, false);

function safeOpenUrl(url) {
  var newTab = window.open();
  newTab.opener = null;
  newTab.location = url;
}

function extSearch(engine) {
  var engines = {
    google: 'https://www.google.com/search?q=',
    bing: 'https://cn.bing.com/search?q=',
    baidu: 'https://www.baidu.com/s?ie=UTF-8&wd=',
  };
  var host = window.location.host;
  var query = $('.search-input input').val().toLowerCase().trim();
  var uri = engines[engine] + query + ' site:' + host;

  if (query) {
    safeOpenUrl(uri);
  } else {
    Stun.utils.popAlert('warning', '请输入字符');
  }
}

var assistSearchList = window.CONFIG.assistSearch;

if (Array.isArray(assistSearchList)) {
  assistSearchList.forEach(function (name) {
    document.querySelector('.search-btns-item--' + name).addEventListener('click', function () {
      extSearch(name);
    }, false);
  });
}</script><script src="https://cdn.jsdelivr.net/npm/leancloud-storage@latest/dist/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script><script>function loadValine () {
  var GUEST_INFO = ['nick', 'mail', 'link'];
  var guest_info = 'nick,mail,link';

  guest_info = guest_info.split(',').filter(function(item) {
    return GUEST_INFO.indexOf(item) > -1;
  });
  new Valine({
    el: '#valine-container',
    appId: 'fGSHbxc61eXC9MgR32tTRLKD-gzGzoHsz',
    appKey: 'ylVHOgsBL6HOffDYf4H7qzDs',
    notify: true,
    verify: true,
    placeholder: '快去评论下吧',
    avatar: 'mp',
    meta: guest_info,
    pageSize: '10' || 10,
    visitor: false,
    recordIP: true,
    lang: 'zh-cn' || 'zh-cn',
    path: window.location.pathname
  });
}

if (false) {
  loadValine();
} else {
  window.addEventListener('DOMContentLoaded', loadValine, false);
}</script><script src="/js/utils.js?v=2.6.2"></script><script src="/js/stun-boot.js?v=2.6.2"></script><script src="/js/scroll.js?v=2.6.2"></script><script src="/js/header.js?v=2.6.2"></script><script src="/js/sidebar.js?v=2.6.2"></script><script type="application/json" src="/search.xml"></script></body></html>